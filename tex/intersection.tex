\section{Some intersection-theoretic lemmas}\label{appendix:intersection}

Consider a morphism of DM stacks $f\colon Y\to X$ over a smooth base $\mathfrak M$, such that $X$ is \emph{smooth} over $\mathfrak M$ and $Y$ carries a virtual class given by a perfect obstruction theory $E^\bullet_{Y/\mathfrak M}$. Then, for every Cartesian diagram
 \bcd
 G\ar[r,"g"]\ar[d,"q"]\ar[rd,phantom,"\Box"] & F\ar[d,"p"] \\
 Y\ar[r,"f"] & X 
 \ecd
and every class $\alpha\in A_*(F)$, we may define
\[
 f^!_{\Delta}(\alpha)=\Delta_X^!([Y]^\text{vir}\times\alpha)\in A_*(G)
\]
which we call a \emph{diagonal} virtual pull-back. We first claim that it coincides with the usual virtual pull-back along $f$ in the presence of a compatible perfect obstruction theory relative to $f$.

\begin{lemma}\label{lem:diagonal_virtual_coincide}
  Assume that there exists a relative obstruction theory $E^\bullet_f$ compatible with $E^\bullet_{Y/\mathfrak M}$ and the standard (unobstructed) obstruction theory for $X$, i.e.
 \bcd
 f^* L^\bullet_{X/\mathfrak M} \ar[r] \ar[d,equal] & E^\bullet_{Y/\mathfrak M} \ar[r] \ar[d] & E^\bullet_f \ar[r,"{[1]}"] \ar[d] & \, \\
 f^* L^\bullet_{X/\mathfrak M} \ar[r] & L^\bullet_{Y/\mathfrak M} \ar[r] & L^\bullet_f \ar[r,"{[1]}"] & \,
 \ecd
 Then for every Cartesian diagram and every class $\alpha\in A_*(F)$ as above,
 \[
  f^!_{E}(\alpha)=f^!_\Delta(\alpha).
 \]
\end{lemma}

Secondly, we claim that the \emph{diagonal} virtual pull-back behaves similarly to an ordinary virtual pull-back (e.g. commutes with other virtual pull-backs) even in the absence of a compatible perfect obstruction theory.

\begin{lemma} The \emph{diagonal} virtual pull-back morphism as defined above commutes with ordinary Gysin maps and with virtual pull-backs. \end{lemma}